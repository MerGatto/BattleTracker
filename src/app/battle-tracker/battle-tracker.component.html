<div class="container-fluid">
<div class="row">
  <div class="col-9 col-xl-10">
    <div class="col-6" style="padding-left: 0">
      <div class="left btn-toolbar">
        <button type="button" class="btn btn-primary" (click)="btnStartRound_Click()" *ngIf="!started">
          {{"Start Round" | translate}}
        </button>
        <button type="button" class="btn btn-primary" (click)="btnNextPass_Click()" *ngIf="started && passEnded">
          {{"Next Pass" | translate}}
        </button>
        <button type="button" class="btn btn-danger" (click)="btnReset_Click()">
          {{"Reset" | translate}}
        </button>
      </div>
    </div>
    <div class="col-6">
      <div class="right btn-toolbar">
        <button id="btnUndo" type="button" class="btn btn-warning" (click)="btnUndo_Click()" title="Undo">
          B
        </button>
        <button id="btnRedo" type="button" class="btn btn-warning" (click)="btnRedo_Click()" title="Redo">
          B
        </button>
      </div>
    </div>
  </div>
</div>
<br>
<div class="row">
<!--PARTICIPANT TABLE-->
<div class="col-9 col-xl-10">
  <div class="row bg-info">
    <div class="col-4 col-lg-2">
      <h4>
        <b>{{"Name" | translate}}</b>
      </h4>
    </div>
    <div class="col-2 col-lg-1 text-center">
      <h4>
        <b>{{"Ini" | translate}}</b>
      </h4>
    </div>
    <div class="col-3 col-lg-1 text-center">
      <h4>
        <b>{{"Dice Roll" | translate}}</b>
      </h4>
    </div>
    <div class="col-3 col-lg-1 text-center">
      <h4>
        <b>{{"Base Ini" | translate}}</b>
      </h4>
    </div>
  </div>

  <!--PARTICIPANT ROWS-->
  <div [sortablejs]="participants.items">
    <div class="row participant" attr.id="participant{{i}}" [attr.data-indexnr]="i" [attr.data.participant]="p"
         (click)="selectActor(p)" [ngClass]="getParticipantStyles(p)" *ngFor="let p of participants.items let i = index let last = last">
      <div class="col-4 col-lg-2">
        <input id="name" name="name" type="text" placeholder="Name" class="form-control" (keydown)="inpName_KeyDown($event)"
               [(ngModel)]="p.name">
      </div>
      <div class="col-2 col-lg-1 text-center">
        <label class="control-label lblIni" for="ini">{{getInitiative(p)}} </label>
      </div>
      <div class="col-3 col-lg-1 text-center">
        <div class="row">
          <div class="col-8 no-padding">
            <input class="form-control inpDiceIni text-center" name="diceIni" type="number" (keydown)="inpDiceIni_KeyDown($event)" (focus)="inp_Focus($event)"
                   (input)="iniChange($event, p)" [(ngModel)]="p.diceIni" #field="ngModel" [min]="0">
          </div>
          <div class="col-4 no-padding">
            <img class="btn-diceroll" src="../../assets/dices.svg" (click)="btnRollInitative_Click(p)">
          </div>
        </div>
      </div>
      <div class="col-3 col-lg-1 text-center">
        <input class="form-control text-center inpBaseIni" name="baseIni" type="number" (focus)="inp_Focus($event)" (keydown)="inpBaseIni_KeyDown($event)" [(ngModel)]="p.baseIni">
      </div>
      <div class="col-9 col-lg-4 btn-toolbar">
        <!--action-->
        <button type="button" class="btn btn-secondary" (click)="btnRollInitative_Click(p)" *ngIf="!started">
          {{"Roll Initiative" | translate}}
        </button>
        <button type="button" class="btn btn-secondary" (click)="btnEdge_Click(p)" *ngIf="!p.edge && (!started || (passEnded && getInitiative(p) > 10))">
          {{"Seize Initiative" | translate}}
        </button>
        <button type="button" class="btn btn-secondary" (click)="btnAct_Click(p)" *ngIf="started && (p.status == 1 || p.status == 2)">
          {{"Action" | translate}}
        </button>
        <button type="button" class="btn btn-secondary" (click)="btnDelay_Click(p)" *ngIf="started && p.status == 1">
          {{"Delay" | translate}}
        </button>
        <div class="btn-group" ngbDropdown *ngIf="started && getInitiative(p) >= 1">
          <button ngbDropdownToggle id="interruptDropdown" type="button" class="btn btn-primary" dropdownToggle>
            {{"Interrupts" | translate}} <span class="caret"></span>
          </button>
          <div ngbDropdownMenu aria-labelledby="interruptDropdown">
            <div class="dropdown-item">
              <div class="col-8 no-padding">
                <button type="button" class="btn btn-secondary btn-block no-border-radius" (click)="btnCustomAction_Click(p, custominterrupt)">
                  {{"Custom" | translate}}
                </button>
              </div>
              <div class="col-4 no-padding">
                <input #custominterrupt class="form-control inpBaseIni text-center no-border-radius" name="customInterruptIni" value="-5" type="number" (click)="keepMenuOpen($event)" (focus)="inp_Focus($event)">
              </div>
            </div>
            <div class="dropdown-item buffer" *ngFor="let action of p.actions.persistentInterrupts">
              <label class=" btn btn-secondary btn-block no-border-radius" [class.active]="p.actions[action.key]">
                <input type="checkbox" class="hide" [(ngModel)]="p.actions[action.key]" (click)="btnAction_Click(p, action, true)" [disabled]="started && p.actions[action.key]">
                {{action.key | translate}}
              </label>
            </div>
            <div class="dropdown-item buffer" *ngFor="let action of p.actions.normalInterrupts">
              <button type="button" class="dropdown-item btn btn-secondary btn-block no-border-radius" (click)="btnAction_Click(p, action, false)">
                {{action.key | translate}}
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-3 col-lg-3 text-right btn-toolbar btn-toolbar-right">
        <button type="button" class="btn btn-primary btn-duplicate" (click)="btnDuplicate_Click(p)"></button>
        <button type="button" class="btn btn-primary" *ngIf="p.ooc" (click)="btnEnterCombat_Click(p)">
          <span class="glyphicon glyphicon-log-in"></span>
        </button>
        <button type="button" class="btn btn-warning" *ngIf="!p.ooc" (click)="btnLeaveCombat_Click(p)">
          <span class="glyphicon glyphicon-log-out"></span>
        </button>
        <button type="button" class="btn btn-danger" (click)="btnDelete_Click(p)">
          <span class="glyphicon glyphicon-remove"></span>
        </button>
      </div>
      <span *ngIf="last">{{ngReady()}}</span>
    </div>
  </div>

  <div>
    <div colspan="8">
      <button type="submit" class="btn btn-primary" (click)="btnAddParticipant_Click()">
        <span class="glyphicon glyphicon-plus"></span>
      </button>
    </div>
  </div>
  <div>
    <div colspan="8">{{"Turn" | translate}} {{combatTurn}}, {{"Pass" | translate}} {{initiativeTurn}}</div>
  </div>
</div>

<!--DETAILS BAR-->
<div class="col-3 col-xl-2 detailsBar">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3>{{selectedActor.name || "Selected Actor" | translate}}</h3>
    </div>
    <div class="panel-body">
      <ngb-tabset>
        <ngb-tab>
          <ng-template ngbTabTitle>{{"Condition Monitor" | translate}}</ng-template>
          <ng-template ngbTabContent>
            <h4>{{"Condition Monitor" | translate}}</h4>
            <div class="row">
              <div class="col-lg-6 cm">
                <h4>Physical</h4>
                <app-condition-monitor [health]="selectedActor.physicalHealth"
                                       [overflow]="selectedActor.overflowHealth"
                                       [painTolerance]="selectedActor.painTolerance"
                                       [hasPainEditor]="selectedActor.hasPainEditor"
                                       [(ngModel)]="selectedActor.physicalDamage">
                </app-condition-monitor>
              </div>
              <div class="col-lg-6 cm">
                <h4>Stun</h4>
                <app-condition-monitor [health]="selectedActor.stunHealth"
                                       [painTolerance]="selectedActor.painTolerance"
                                       [hasPainEditor]="selectedActor.hasPainEditor"
                                       [(ngModel)]="selectedActor.stunDamage">
                </app-condition-monitor>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
        <ngb-tab>
          <ng-template ngbTabTitle>{{"Options" | translate}}</ng-template>
          <ng-template ngbTabContent>
            <h4>{{"Options" | translate}}</h4>
            <div class="row">
              <div class="col-12">
                <label>{{"Overflow" | translate}}</label>
              </div>
              <div class="col-12">
                <range-slider [(ngModel)]="selectedActor.overflowHealth" min="0" max="20" step="1"></range-slider>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <label>{{"Physical Health" | translate}}</label>
              </div>
              <div class="col-12">
                <range-slider [(ngModel)]="selectedActor.physicalHealth" min="1" max="20" step="1"></range-slider>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <label>{{"Stun Health" | translate}}</label>
              </div>
              <div class="col-12">
                <range-slider [(ngModel)]="selectedActor.stunHealth" min="1" max="20" step="1"></range-slider>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <label>{{"Pain Tolerance" | translate}}</label>
              </div>
              <div class="col-12">
                <range-slider [(ngModel)]="selectedActor.painTolerance" min="0" max="20" step="1"></range-slider>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <label>{{"Pain Editor" | translate}}</label>
              </div>
              <div class="col-12">
                <label class="switch">
                  <input type="checkbox" [(ngModel)]="selectedActor.hasPainEditor" />
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <label>{{"Dices" | translate}}</label>
              </div>
              <div class="col-12">
                <range-slider [(ngModel)]="selectedActor.dices" min="1" max="5" step="1"></range-slider>
              </div>
            </div>
          </ng-template>
        </ngb-tab>
      </ngb-tabset>
    </div>
</div>

</div>
<!--<div class="row">
  <div class="col-9 col-xl-10">
    <button id="btnLogToggle" class="btn btn-primary" data-toggle="collapse" data-target="#globalLog">Log</button>
    <div id="globalLog" class="collapse">
      <table>
        <tr *ngFor="let l of logHandler.log">
          {{l.text}}
        </tr>
      </table>
    </div>
  </div>
</div>-->
</div>
